webpackJsonp([4],{"80ce":function(t,e,a){var r=a("p79t");"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);a("FIqI")("6aba7c1e",r,!0,{})},WQQx:function(t,e,a){"use strict";function r(t){return Object(m.a)({url:"/admin/role/index"+c,method:"get",params:t})}function i(t){return Object(m.a)({url:"/admin/role/auth"+c,method:"get",params:t})}function o(t){return Object(m.a)({url:"/admin/role/auth"+c,method:"post",data:t})}function s(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"post",r="add"===e?"/admin/role/save"+c:"/admin/role/edit"+c;return Object(m.a)({url:r,method:a,data:t})}function n(t){return Object(m.a)({url:"/admin/role/delete"+c,method:"post",data:t})}function l(t){if(Array.isArray(t)){for(var e=0,a=Array(t.length);e<t.length;e++)a[e]=t[e];return a}return Array.from(t)}function u(t){a("80ce")}Object.defineProperty(e,"__esModule",{value:!0});var m=a("Vo7i"),c=".json",f={id:"",name:"",status:"1",remark:"",listorder:999},d={data:function(){return{query:{name:"",status:""},list:[],loading:!0,authList:[],defaultProps:{children:"children",label:"title"},authLoading:!1,authFormVisible:!1,authFormData:{role_id:"",auth_rules:[]},index:null,formName:null,formMap:{add:"新增",edit:"编辑"},formLoading:!1,formVisible:!1,formData:f,formRules:{name:[{required:!0,message:"请输入名称",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},deleteLoading:!1}},methods:{onSubmit:function(){this.getList()},getList:function(){var t=this;this.loading=!0,r(this.query).then(function(e){t.loading=!1,t.list=e||[]}).catch(function(){t.loading=!1,t.list=[]})},handleAuth:function(t){var e=this;this.authFormVisible=!0,this.authFormData.role_id=t,this.authFormData.auth_rules=[],this.authList=[],i({id:t}).then(function(t){e.authList=t.auth_list||[];var a=t.checked_keys||[],r=[],i=null,o=null;for(var s in a)i=a[s],function t(e,a){for(var r in e){var i=e[r];i.id===a&&(o=i),t(i.children,a)}}(e.authList,i),o&&o.children.length<=0&&r.push(i);e.$refs.tree.setCheckedKeys(r)}).catch(function(){})},authSubmit:function(){var t=this;this.authLoading=!0;var e=this.$refs.tree.getCheckedKeys(),a=[];for(var r in e){var i=this.$refs.tree.getNode(e[r]);a=a.concat(function t(e){var a=[];return(e.data.id||null)&&a.push(e.data.id),e.parent&&(a=a.concat(t(e.parent))),a}(i))}var s=new Set(a);if(this.authFormData.auth_rules=[].concat(l(s)),!this.authFormData)return this.$alert("请至少选择一个权限","提示",{confirmButtonText:"确定"}),!1;o(this.authFormData).then(function(e){t.authLoading=!1,e.errcode?t.$message({message:e.errmsg,type:"error"}):(t.$message({message:"授权成功",type:"success"}),t.authFormVisible=!1)}).catch(function(){t.editLoading=!1})},handleForm:function(t,e){this.formVisible=!0,this.formData=Object.assign({},f),null!==e&&(this.formData=Object.assign({},e)),this.formData.status+="",this.formName="add",null!==t&&(this.index=t,this.formName="edit"),this.$refs.dataForm&&this.$refs.dataForm.clearValidate()},formSubmit:function(){var t=this;this.$refs.dataForm.validate(function(e){if(e){t.formLoading=!0;var a=Object.assign({},t.formData);s(a,t.formName).then(function(e){t.formLoading=!1,e.errcode?t.$message({message:e.errmsg,type:"error"}):(t.$message({message:"操作成功",type:"success"}),t.$refs.dataForm.resetFields(),t.formVisible=!1,"add"===t.formName?t.list.unshift(e):t.list.splice(t.index,1,a))}).catch(function(){t.formLoading=!1})}})},handleDel:function(t,e){var a=this;e.id&&this.$confirm("确认删除该记录吗?","提示",{type:"warning"}).then(function(){a.deleteLoading=!0,n({id:e.id}).then(function(e){a.deleteLoading=!1,e.errcode?a.$message({message:e.errmsg,type:"error"}):(a.$message({message:"删除成功",type:"success"}),a.list.splice(t,1))}).catch(function(){a.deleteLoading=!1})}).catch(function(){a.$message({type:"info",message:"取消删除"})})}},filters:{statusFilterType:function(t){return{0:"gray",1:"success"}[t]},statusFilterName:function(t){return{0:"禁用",1:"正常"}[t]}},mounted:function(){},created:function(){this.getList()}},h=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-form",{staticClass:"query-form",attrs:{inline:!0,model:t.query,size:"mini"}},[a("el-form-item",{staticClass:"query-form-item"},[a("el-input",{attrs:{placeholder:"角色名称"},model:{value:t.query.name,callback:function(e){t.$set(t.query,"name",e)},expression:"query.name"}})],1),t._v(" "),a("el-form-item",{staticClass:"query-form-item"},[a("el-select",{attrs:{placeholder:"状态"},model:{value:t.query.status,callback:function(e){t.$set(t.query,"status",e)},expression:"query.status"}},[a("el-option",{attrs:{label:"禁用",value:"0"}}),t._v(" "),a("el-option",{attrs:{label:"正常",value:"1"}})],1)],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-refresh"},on:{click:t.getList}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"search"},on:{click:t.onSubmit}},[t._v("查询")])],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(e){t.handleForm(null,null)}}},[t._v("新增")])],1)],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.list,"max-height":"500"}},[a("el-table-column",{attrs:{label:"角色 ID",prop:"id"}}),t._v(" "),a("el-table-column",{attrs:{label:"角色名称",prop:"name"}}),t._v(" "),a("el-table-column",{attrs:{label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{type:t._f("statusFilterType")(e.row.status)}},[t._v(t._s(t._f("statusFilterName")(e.row.status)))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"描述","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.remark))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",fixed:"right",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticStyle:{"margin-left":"0"},attrs:{size:"small"},nativeOn:{click:function(a){t.handleAuth(e.row.id)}}},[t._v("授权")]),t._v(" "),a("el-button",{staticStyle:{"margin-left":"0"},attrs:{size:"small"},nativeOn:{click:function(a){t.handleForm(e.$index,e.row)}}},[t._v("编辑")]),t._v(" "),a("el-button",{staticStyle:{"margin-left":"0"},attrs:{type:"danger",size:"small",loading:t.deleteLoading},nativeOn:{click:function(a){t.handleDel(e.$index,e.row)}}},[t._v("删除\n                ")])]}}])})],1),t._v(" "),a("el-dialog",{staticClass:"dialog",attrs:{title:"授权",visible:t.authFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(e){t.authFormVisible=e}}},[a("el-tree",{ref:"tree",staticStyle:{"max-height":"75vh","overflow-y":"auto"},attrs:{data:t.authList,"show-checkbox":"","default-expand-all":"","node-key":"id",props:t.defaultProps}}),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(e){t.authFormVisible=!t.authFormVisible}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary",loading:t.authLoading},nativeOn:{click:function(e){t.authSubmit()}}},[t._v("提交\n            ")])],1)],1),t._v(" "),a("el-dialog",{attrs:{title:t.formMap[t.formName],visible:t.formVisible,width:"85%",top:"5vh"},on:{"update:visible":function(e){t.formVisible=e}}},[a("el-form",{ref:"dataForm",attrs:{model:t.formData,rules:t.formRules}},[a("el-form-item",{attrs:{label:"角色名称",prop:"name"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"排序",prop:"listorder"}},[a("el-input",{attrs:{type:"","auto-complete":"off"},model:{value:t.formData.listorder,callback:function(e){t.$set(t.formData,"listorder",e)},expression:"formData.listorder"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"状态",prop:"status"}},[a("el-radio-group",{model:{value:t.formData.status,callback:function(e){t.$set(t.formData,"status",e)},expression:"formData.status"}},[a("el-radio",{attrs:{label:"0"}},[t._v("禁用")]),t._v(" "),a("el-radio",{attrs:{label:"1"}},[t._v("正常")])],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"描述"}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.formData.remark,callback:function(e){t.$set(t.formData,"remark",e)},expression:"formData.remark"}})],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(e){t.formVisible=!t.formVisible}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary",loading:t.formLoading},nativeOn:{click:function(e){t.formSubmit()}}},[t._v("提交")])],1)],1)],1)},v=[],p={render:h,staticRenderFns:v},g=p,b=a("Z0/y"),y=u,_=b(d,g,!1,y,null,null);e.default=_.exports},p79t:function(t,e,a){e=t.exports=a("UTlt")(!0),e.push([t.i,"","",{version:3,sources:[],names:[],mappings:"",file:"role.vue",sourceRoot:""}])}});
//# sourceMappingURL=4.92f5f6096eaf64cc27cc.js.map